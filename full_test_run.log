[0;36m╔════════════════════════════════════════════════════════════════════════════╗[0m
[0;36m║              IBM MQ PARENT-CHILD ULTIMATE PROOF RUNNER                     ║[0m
[0;36m║                            FIXED VERSION                                   ║[0m
[0;36m║                                                                            ║[0m
[0;36m║  This implements all 5 ChatGPT recommendations:                           ║[0m
[0;36m║  1. Proves each Session has own HCONN                                     ║[0m
[0;36m║  2. Uses APPLTAG for grouping                                             ║[0m
[0;36m║  3. Uses PCF/MQSC for verification                                        ║[0m
[0;36m║  4. Enables JMS tracing                                                   ║[0m
[0;36m║  5. Captures network packets                                              ║[0m
[0;36m╚════════════════════════════════════════════════════════════════════════════╝[0m

[0;32mOutput Directory: ultimate_proof_20250907_165053[0m

[1;33m═══ PRE-FLIGHT CHECKS ═══[0m
[0;32mChecking Queue Managers...[0m
  ✓ QM1 is running
  ✓ QM2 is running
  ✓ QM3 is running
[0;32mAvailable IBM MQ libraries:[0m
  • /home/ec2-user/unified/demo5/mq-uniform-cluster/libs/com.ibm.mq.allclient-9.3.5.0.jar
  • /home/ec2-user/unified/demo5/mq-uniform-cluster/libs/javax.jms-api-2.0.1.jar
  • /home/ec2-user/unified/demo5/mq-uniform-cluster/libs/json-20231013.jar
[0;32m✓ All pre-flight checks passed[0m

[1;33m═══ CONFIGURING COMPREHENSIVE TRACING ═══[0m
[0;32m✓ Trace configuration created[0m
[0;32m✓ Environment variables set for tracing[0m
  JMS_TRACE=1
  MQJMS_TRACE_LEVEL=all
  MQJMS_TRACE_DIR=ultimate_proof_20250907_165053

[1;33m═══ COMPILING JAVA TEST ═══[0m
[0;32mCompiling MQParentChildUltimateProof.java...[0m
[0;32m✓ Compilation successful[0m

[1;33m═══ STARTING PACKET CAPTURE ═══[0m
[0;32mStarting tcpdump...[0m
  QM1: 10.10.10.10
  QM2: 10.10.10.11
  QM3: 10.10.10.12
  Packet capture started (PID: 1463)
  Output: ultimate_proof_20250907_165053/mq_packets.pcap

[1;33m═══ CAPTURING PRE-TEST STATE ═══[0m
[0;32mCapturing QM1 state...[0m
  QM1: 1 active connections
[0;32mCapturing QM2 state...[0m
  QM2: 1 active connections
[0;32mCapturing QM3 state...[0m
  QM3: 1 active connections

[1;33m═══ RUNNING ULTIMATE PROOF TEST WITH FULL TRACING ═══[0m
[0;32mThis will:[0m
  1. Create 1 JMS Connection (first HCONN)
  2. Create 5 JMS Sessions (5 more HCONNs)
  3. Verify all 6 connections on same QM
  4. Prove other QMs have 0 connections
  5. Collect comprehensive trace data

[0;32mStarting test execution...[0m
╔══════════════════════════════════════════════════════════════════════════════╗
║                      IBM MQ PARENT-CHILD ULTIMATE PROOF                      ║
║                   Implementing All ChatGPT Recommendations                   ║
╠══════════════════════════════════════════════════════════════════════════════╣
║ Tracking Key: PROOF-1757263859702                                          ║
║ Target QM: QM1                                                              ║
║ Sessions: 5                                                                 ║
╚══════════════════════════════════════════════════════════════════════════════╝

ENABLING JMS TRACE (Recommendation #4)
============================================================
✓ JMS trace enabled: JMS_TRACE_PROOF-1757263859702.trc
✓ Trace will show every MQCONN with HCONN values

CREATING CONNECTION FACTORY WITH APPLTAG (Recommendation #2)
============================================================
The IBM MQ messaging client trace mechanism is tracing to '/JMS_TRACE_PROOF-1757263859702.trc'
✓ WMQ_APPLICATIONNAME = PROOF-1757263859702
  This APPLTAG will group parent + all sessions
✓ WMQ_CONNECTION_TAG = PARENT-CHILD-TEST-1757263859702
✓ SHARE_CONV will use channel configuration
  Note: This affects TCP sharing, NOT the number of HCONNs
✓ Connection factory configured for QM1

CAPTURING PRE-TEST STATE
============================================================
  QM1: 0 connections with APPLTAG 'PROOF-1757263859702'
  QM2: 0 connections with APPLTAG 'PROOF-1757263859702'
  QM3: 0 connections with APPLTAG 'PROOF-1757263859702'
✓ All QMs should have 0 connections before test

CREATING PARENT JMS CONNECTION (First HCONN)
============================================================
✓ JMS Connection created in 900ms
  This creates the FIRST MQ connection (HCONN)

PARENT CONNECTION DETAILS:
  Connection ID: unknown
  Queue Manager: unknown
  APPLTAG: PROOF-1757263859702
✓ Connection started

CREATING 5 CHILD SESSIONS (Each gets own HCONN)
============================================================
Key Point: Each createSession() creates a NEW MQ connection

Creating Session #1...
  ✓ Session #1 created in 224ms
    This is MQ connection #2 (parent + 1 sessions)
    Queue Manager: unknown
    APPLTAG: PROOF-1757263859702 (inherited from parent)
    ✓ Test message sent

Creating Session #2...
  ✓ Session #2 created in 162ms
    This is MQ connection #3 (parent + 2 sessions)
    Queue Manager: unknown
    APPLTAG: PROOF-1757263859702 (inherited from parent)
    ✓ Test message sent

Creating Session #3...
  ✓ Session #3 created in 217ms
    This is MQ connection #4 (parent + 3 sessions)
    Queue Manager: unknown
    APPLTAG: PROOF-1757263859702 (inherited from parent)
    ✓ Test message sent

Creating Session #4...
  ✓ Session #4 created in 167ms
    This is MQ connection #5 (parent + 4 sessions)
    Queue Manager: unknown
    APPLTAG: PROOF-1757263859702 (inherited from parent)
    ✓ Test message sent

Creating Session #5...
  ✓ Session #5 created in 205ms
    This is MQ connection #6 (parent + 5 sessions)
    Queue Manager: unknown
    APPLTAG: PROOF-1757263859702 (inherited from parent)
    ✓ Test message sent

SUMMARY: Created 5 sessions
Expected MQ connections: 6 (1 parent + 5 sessions)

VERIFYING QUEUE MANAGER AFFINITY
============================================================
  QM1: 0 connections
  QM2: 0 connections
  QM3: 0 connections

❌ UNEXPECTED DISTRIBUTION!
  Expected all on QM1 but found distribution across QMs

SHARED CONVERSATION ANALYSIS (Recommendation #5)
============================================================
SHARECNV affects TCP sharing, NOT HCONN count

Channel APP.SVRCONN SHARECNV: unknown

TCP connections on port 1414: 0
MQ connections (HCONNs): 6

Could not parse SHARECNV value: unknown

KEY POINT: SHARECNV doesn't change the one-HCONN-per-session rule!

VERIFYING OTHER QUEUE MANAGERS ARE EMPTY
============================================================

Checking QM2:
  Total connections on APP.SVRCONN: 0
  Connections with our APPLTAG: 0
  ✅ Confirmed: No connections from our test

Checking QM3:
  Total connections on APP.SVRCONN: 0
  Connections with our APPLTAG: 0
  ✅ Confirmed: No connections from our test

✓ Proof report generated: PROOF_REPORT_PROOF-1757263859702.md


============================================================
KEEPING CONNECTION ALIVE FOR VERIFICATION
============================================================

Manual verification commands:

1. Check QM1 (should have 6 connections):
   docker exec qm1 bash -c "echo 'DIS CONN(*) WHERE(APPLTAG EQ \'PROOF-1757263859702\')' | runmqsc QM1"

2. Check QM2 (should have 0 connections):
   docker exec qm2 bash -c "echo 'DIS CONN(*) WHERE(APPLTAG EQ \'PROOF-1757263859702\')' | runmqsc QM2"

3. Check QM3 (should have 0 connections):
   docker exec qm3 bash -c "echo 'DIS CONN(*) WHERE(APPLTAG EQ \'PROOF-1757263859702\')' | runmqsc QM3"

Keeping alive for 60 seconds...
Time remaining: 60 seconds  Time remaining: 59 seconds  Time remaining: 58 seconds  Time remaining: 57 seconds  Time remaining: 56 seconds  Time remaining: 55 seconds  Time remaining: 54 seconds  Time remaining: 53 seconds  Time remaining: 52 seconds  Time remaining: 51 seconds  Time remaining: 50 seconds  Time remaining: 49 seconds  Time remaining: 48 seconds  Time remaining: 47 seconds  Time remaining: 46 seconds  Time remaining: 45 seconds  Time remaining: 44 seconds  Time remaining: 43 seconds  Time remaining: 42 seconds  Time remaining: 41 seconds  Time remaining: 40 seconds  Time remaining: 39 seconds  Time remaining: 38 seconds  Time remaining: 37 seconds  Time remaining: 36 seconds  Time remaining: 35 seconds  Time remaining: 34 seconds  Time remaining: 33 seconds  Time remaining: 32 seconds  Time remaining: 31 seconds  Time remaining: 30 seconds  Time remaining: 29 seconds  Time remaining: 28 seconds  Time remaining: 27 seconds  Time remaining: 26 seconds  Time remaining: 25 seconds  Time remaining: 24 seconds  Time remaining: 23 seconds  Time remaining: 22 seconds  Time remaining: 21 seconds  Time remaining: 20 seconds  Time remaining: 19 seconds  Time remaining: 18 seconds  Time remaining: 17 seconds  Time remaining: 16 seconds  Time remaining: 15 seconds  Time remaining: 14 seconds  Time remaining: 13 seconds  Time remaining: 12 seconds  Time remaining: 11 seconds  Time remaining: 10 seconds  Time remaining: 9 seconds  Time remaining: 8 seconds  Time remaining: 7 seconds  Time remaining: 6 seconds  Time remaining: 5 seconds  Time remaining: 4 seconds  Time remaining: 3 seconds  Time remaining: 2 seconds  Time remaining: 1 seconds  

CLEANUP
============================================================
  Closed session #1
  Closed session #2
  Closed session #3
  Closed session #4
  Closed session #5
  Closed parent connection


[0;32m✓ Test completed successfully[0m

[1;33m═══ CAPTURING POST-TEST STATE ═══[0m
[0;32mTracking Key: Key:[0m
[0;32mCapturing QM1 final state...[0m
  QM1: 2 connections with tracking key
[0;32mCapturing QM2 final state...[0m
  QM2: 2 connections with tracking key
[0;32mCapturing QM3 final state...[0m
  QM3: 2 connections with tracking key

[1;33m═══ STOPPING PACKET CAPTURE ═══[0m
[0;32m✓ Packet capture saved: ultimate_proof_20250907_165053/mq_packets.pcap (192K)[0m

[0;32mPacket distribution:[0m
  QM1 (10.10.10.10): 373 packets
  QM2 (10.10.10.11): 0 packets
  QM3 (10.10.10.12): 0 packets

[1;33m═══ COLLECTING ALL EVIDENCE FILES ═══[0m
[0;32mEvidence files collected:[0m
[0;34mConfiguration files:[0m
  • ultimate_proof_20250907_165053/trace.properties
[0;34mTrace files:[0m
[0;34mLog files:[0m
  • ultimate_proof_20250907_165053/compile.log
  • ultimate_proof_20250907_165053/tcpdump.log
  • ultimate_proof_20250907_165053/test_output.log
[0;34mMQSC dumps:[0m
  • ultimate_proof_20250907_165053/post_test_qm1_all_connections.txt
  • ultimate_proof_20250907_165053/post_test_qm1_tracked_connections.txt
  • ultimate_proof_20250907_165053/post_test_qm2_all_connections.txt
  • ultimate_proof_20250907_165053/post_test_qm2_tracked_connections.txt
  • ultimate_proof_20250907_165053/post_test_qm3_all_connections.txt
  • ultimate_proof_20250907_165053/post_test_qm3_tracked_connections.txt
  • ultimate_proof_20250907_165053/pre_test_qm1_connections.txt
  • ultimate_proof_20250907_165053/pre_test_qm2_connections.txt
  • ultimate_proof_20250907_165053/pre_test_qm3_connections.txt
[0;34mPacket captures:[0m
  • ultimate_proof_20250907_165053/mq_packets.pcap
[0;34mReports:[0m

[1;33m═══ GENERATING COMPREHENSIVE ANALYSIS REPORT ═══[0m
[0;32m✓ Analysis report generated: ultimate_proof_20250907_165053/COMPREHENSIVE_ANALYSIS.md[0m

[0;36m╔════════════════════════════════════════════════════════════════════════════╗[0m
[0;36m║                    TEST EXECUTION COMPLETE - FIXED VERSION                 ║[0m
[0;36m╠════════════════════════════════════════════════════════════════════════════╣[0m
[0;36m║ Evidence Directory: ultimate_proof_20250907_165053                          ║[0m
[0;36m║                                                                            ║[0m
[0;36m║ Evidence Collected:                                                        ║[0m
[0;36m║   • JMS Trace files: 0 files                                               ║[0m
[0;36m║   • MQSC dumps: 9 files                                                    ║[0m
[0;36m║   • Log files: 3 files                                                     ║[0m
[0;36m║   • Packet capture: ✓ Collected                                          ║[0m
[0;36m║                                                                            ║[0m
[0;36m║ View comprehensive analysis:                                               ║[0m
[0;36m║   cat ultimate_proof_20250907_165053/COMPREHENSIVE_ANALYSIS.md                    ║[0m
[0;36m╚════════════════════════════════════════════════════════════════════════════╝[0m

[0;32m✅ ULTIMATE PROOF SUCCESSFULLY COLLECTED WITH FULL TRACING![0m

[0;32mQuick verification:[0m
cd ultimate_proof_20250907_165053 && ls -la
